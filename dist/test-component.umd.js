(function(y,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(y=typeof globalThis<"u"?globalThis:y||self,e(y.TestComponent={},y.Vue))})(this,function(y,e){"use strict";const v={__name:"Letter",props:{char:String,color:String},setup(r){return(o,l)=>(e.openBlock(),e.createElementBlock("div",{style:e.normalizeStyle({color:r.color})},e.toDisplayString(r.char),5))}},_=(r,o)=>{const l=r.__vccOpts||r;for(const[n,i]of o)l[n]=i;return l},W=_({__name:"Caret",props:{offset:Number},setup(r){return(o,l)=>(e.openBlock(),e.createElementBlock("div",{className:"caret",style:e.normalizeStyle({left:r.offset+"ch"})},null,4))}},[["__scopeId","data-v-86a5189b"]]),S=_(e.defineComponent({__name:"Word",props:{word:{type:String,required:!0},typedWord:{type:String,required:!0},wordStatus:{type:String,required:!0}},setup(r){e.useCssVars(c=>({e6436472:i.value}));const o=r,l=e.useTemplateRef("ref"),n=e.computed(()=>o.typedWord.slice(o.word.length)),i=e.computed(()=>o.wordStatus==="incorrect"?t("incorrect")+" solid 0.1lh":"transparent solid 0.1lh"),f=(c,a)=>o.typedWord.charAt(a)===c?"correct":o.typedWord.charAt(a)!=""?"incorrect":o.wordStatus==="active"?"active":"passive",t=c=>{switch(c){case"passive":return"#ccc";case"active":return"#777";case"correct":return"#000";case"incorrect":return"red"}};return e.onUpdated(async()=>{o.wordStatus==="active"&&(await e.nextTick(),l.value?.scrollIntoView({behavior:"smooth",block:"center"}))}),(c,a)=>(e.openBlock(),e.createElementBlock("div",{class:"word",ref_key:"ref",ref:l},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.word,(u,d)=>(e.openBlock(),e.createBlock(v,{key:d,char:u,color:t(f(u,d))},null,8,["char","color"]))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(u,d)=>(e.openBlock(),e.createBlock(v,{key:"s"+d,char:u,color:t("incorrect")},null,8,["char","color"]))),128)),r.wordStatus==="active"?(e.openBlock(),e.createBlock(W,{key:0,offset:r.typedWord?.length||0},null,8,["offset"])):e.createCommentVNode("",!0)],512))}}),[["__scopeId","data-v-595f7012"]]),T={class:"wordSet"},L=_(e.defineComponent({__name:"WordSet",props:{wordList:{type:Array,required:!0},typedWordList:{type:Array,required:!0},activeWordIndex:{type:Number,required:!0}},setup(r){const o=r,l=(n,i)=>o.activeWordIndex===i?"active":o.activeWordIndex>i?o.typedWordList[i]!==n?"incorrect":"correct":"passive";return(n,i)=>(e.openBlock(),e.createElementBlock("div",T,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.wordList,(f,t)=>(e.openBlock(),e.createBlock(S,{key:f+t,word:f,typedWord:r.typedWordList[t]||"",wordStatus:l(f,t)},null,8,["word","typedWord","wordStatus"]))),128))]))}}),[["__scopeId","data-v-0c65b6ed"]]),E=_(e.defineComponent({__name:"TypingTest",props:{text:{type:Array,required:!0}},emits:["results_ready"],setup(r,{expose:o,emit:l}){const n=r,i=l,f=e.useTemplateRef("typingTest"),t=e.ref([""]),c=e.ref(0),a=e.ref({}),u=e.ref(0),d=e.ref(-1),m=e.ref([]),I=s=>{if(n.text===null||d.value===-2)return;s.preventDefault();const p=t.value[t.value.length-1]||"";if(s.key===" "){t.value.length!==n.text.length&&(n.text[c.value]?.length!==p?.length&&(u.value=u.value+((n.text[c.value]?.length||0)-p.length)),t.value=[...t.value,""],c.value++,m.value=[...m.value,{key:"Space",time:Date.now()}]);return}if(s.key==="Backspace"){if(s.ctrlKey)c.value!==0?p?.length===0?(t.value=[...t.value.slice(0,-2),""],c.value--):t.value=[...t.value.slice(0,-1),""]:t.value=[""];else if(p?.length===0)c.value!==0&&(t.value=t.value.slice(0,-1),c.value--);else{let h=t.value.slice(0,-1);h.push(p?.slice(0,-1)||""),t.value=h}m.value=[...m.value,{key:"Backspace",time:Date.now()}];return}if(s.key.match(/^[-a-zA-Z0-9!@#$%^&*()_+=[\]{};':",./<>?\\|`~]$/)){d.value===-1&&(d.value=Date.now());const h=n.text[c.value]?.charAt(p?.length||0);s.key!==h&&u.value++;let x=t.value.slice(0,-1);if(x.push(p+s.key),t.value=x,m.value=[...m.value,{key:s.key,time:Date.now()}],t.value.length===n.text.length&&(p?.length||0)===(n.text[c.value]?.length||0)-1){const w=(Date.now()-d.value)/1e3;d.value=-2;const B=n.text.flatMap((k,g)=>k.split("").map(($,q)=>t.value[g]?.charAt(q)!==$?1:0)).reduce((k,g)=>k+g,0),C=u.value-B,b=n.text.length/(w/60);a.value={time_taken:w,uncorrected_errors:B,corrected_errors:C,wpm:b,text_length:n.text.join("").length+(n.text.length-1),keystroke_log:m.value},i("results_ready",{results:a.value}),console.log(a.value)}}};return o({getResults:async()=>{if(a.value)return a.value;for(;;)if(await new Promise(s=>setTimeout(s,1e4)),a.value)return a}}),e.onMounted(()=>{f.value?.focus()}),(s,p)=>(e.openBlock(),e.createElementBlock("div",{class:"test",ref_key:"typingTest",ref:f,tabindex:"0",onKeydown:I},[e.createVNode(L,{wordList:r.text,typedWordList:t.value,activeWordIndex:c.value},null,8,["wordList","typedWordList","activeWordIndex"])],544))}}),[["__scopeId","data-v-d4848a5a"]]);y.TypingTest=E,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
